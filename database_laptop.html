<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Data Laptop</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar for Desktop -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <a class="navbar-brand text-navy" href="index.html"><i class="bi bi-pc-display"></i></i> LAB ITAMA</a>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="admin.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="database_proyektor.html"><i class="fa-solid fa-video"></i> Input Proyektor</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="database_laptop.html"><i class="fa-solid fa-laptop"></i> Input Laptop</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="database_mahasiswas.html"><i class="fa-solid fa-user-graduate"></i> Input Mahasiswa</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="riwayat.html"><i class="fa-solid fa-clock-rotate-left"></i> Riwayat</a>
                </li>
            </ul>
        </nav>
        
        <!-- Offcanvas Sidebar for Mobile -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasSidebarLabel"><a class="navbar-brand text-navy" href="index.html"><i class="bi bi-pc-display"></i></i> LAB ITAMA</a></h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="admin.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="database_proyektor.html"><i class="fa-solid fa-video"></i> Input Proyektor</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="database_laptop.html"><i class="fa-solid fa-laptop"></i> Input Laptop</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="database_mahasiswas.html"><i class="fa-solid fa-user-graduate"></i> Input Mahasiswa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="riwayat.html"><i class="fa-solid fa-clock-rotate-left"></i> Riwayat</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Top Navbar for Mobile Toggle -->
            <nav class="navbar navbar-light bg-light d-lg-none mb-3">
                <div class="container-fluid">
                    <button class="btn btn-navy" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <span class="navbar-brand mb-0 h1">Input Laptop</span>
                </div>
            </nav>

            <h1 class="mb-4 d-none d-lg-block">Manajemen Data Laptop</h1>

            <div class="card">
                <div class="card-header">Formulir Laptop</div>
                <div class="card-body">
                    <form id="laptopForm">
                        <input type="hidden" id="laptopId">
                        <div class="mb-3"><label for="id" class="form-label">ID Laptop</label><input type="text" class="form-control" id="id" required></div>
                        <div class="mb-3"><label for="merek" class="form-label">Merek</label><input type="text" class="form-control" id="merek" required></div>
                        <div class="mb-3"><label for="idMahasiswaPemilik" class="form-label">ID Mahasiswa Pemilik</label><input type="text" class="form-control" id="idMahasiswaPemilik" required></div>
                        <button type="submit" class="btn btn-navy">Tambah/Update</button>
                        <button type="button" id="cancelEdit" class="btn btn-secondary hidden">Batal Edit</button>
                    </form>
                </div>
            </div>

            <h2 class="mt-5">Daftar Laptop</h2>
            <div class="table-responsive">
                <table id="laptopTable" class="table table-striped table-hover">
                    <thead class="bg-navy">
                        <tr><th>ID</th><th>Merek</th><th>Nama Pemilik</th><th>Aksi</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const laptopForm = document.getElementById('laptopForm');
        const idInput = document.getElementById('id');
        const merekInput = document.getElementById('merek');
        const idMahasiswaPemilikInput = document.getElementById('idMahasiswaPemilik');
        const laptopTableBody = document.querySelector('#laptopTable tbody');
        const cancelEditButton = document.getElementById('cancelEdit');
        let editingLaptopId = null;

        async function fetchLaptops() {
            const response = await fetch('/api/laptops');
            const laptops = await response.json();
            displayLaptops(laptops);
        }

        function displayLaptops(laptops) {
            laptopTableBody.innerHTML = '';
            laptops.forEach(laptop => {
                const row = laptopTableBody.insertRow();
                row.innerHTML = `
                    <td>${laptop.id}</td><td>${laptop.merek}</td><td>${laptop.namaPemilik || 'N/A'}</td>
                    <td>
                        <button class="btn btn-navy btn-sm" onclick='editLaptop(${JSON.stringify(laptop)})'>Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteLaptop('${laptop.id}')">Hapus</button>
                    </td>`;
            });
        }

        function editLaptop(laptop) {
            editingLaptopId = laptop.id;
            idInput.value = laptop.id;
            idInput.readOnly = true;
            merekInput.value = laptop.merek;
            idMahasiswaPemilikInput.value = laptop.idMahasiswaPemilik;
            cancelEditButton.style.display = 'inline-block';
        }

        cancelEditButton.onclick = () => {
            editingLaptopId = null;
            laptopForm.reset();
            idInput.readOnly = false;
            cancelEditButton.style.display = 'none';
        };

        laptopForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const laptopData = { id: idInput.value, merek: merekInput.value, idMahasiswaPemilik: idMahasiswaPemilikInput.value };
            const url = editingLaptopId ? `/api/laptops/${editingLaptopId}` : '/api/laptops';
            const method = editingLaptopId ? 'PUT' : 'POST';
            const response = await fetch(url, { method: method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(laptopData) });
            if (response.ok) {
                cancelEditButton.onclick();
                fetchLaptops();
            } else {
                alert(`Gagal: ${(await response.json()).message || response.statusText}`);
            }
        });

        async function deleteLaptop(id) {
            if (!confirm('Anda yakin?')) return;
            const response = await fetch(`/api/laptops/${id}`, { method: 'DELETE' });
            if (response.ok) fetchLaptops();
            else alert(`Gagal: ${(await response.json()).message || response.statusText}`);
        }

        document.addEventListener('DOMContentLoaded', fetchLaptops);
    </script>
</body>
</html>
